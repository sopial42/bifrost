name: Ratios service
version: '2'

testcases:
  - name: Reset db
    steps:
      - type: dbfixtures
        database: postgres
        dsn: "{{ .pgsql_dsn }}"
        migrations: ../../data/schemas/
        folder: ../../data/fixtures/ratios
        retry: 10
  - name: Create ratios
    steps:
      - type: http
        method: POST
        url: "{{.url}}/ratios"
        headers:
          Content-Type: application/json
        body: |
          {
            "ratios": [
              {
                "position_id": "33334567-3333-3333-a456-426614174000",
                "ratio": 0.5,
                "date": "2024-03-20T10:00:00Z"
              }
            ]
          }
        assertions:
          - result.statuscode ShouldEqual 201
          - result.bodyjson ShouldHaveLength 1
          - result.bodyjson.bodyjson0 ShouldHaveLength 4
          - result.bodyjson.bodyjson0.date ShouldEqual "2024-03-20T10:00:00Z"
          - result.bodyjson.bodyjson0.id ShouldHaveLength 36
          - result.bodyjson.bodyjson0.position_id ShouldEqual "33334567-3333-3333-a456-426614174000"
          - result.bodyjson.bodyjson0.ratio ShouldEqual 0.5
