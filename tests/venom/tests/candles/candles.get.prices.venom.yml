name: Candles service - GET
version: '2'

testcases:
  - name: Reset db 
    steps:
      - type: dbfixtures
        database: postgres
        dsn: "{{ .pgsql_dsn }}"
        migrations: ../../data/schemas/
        folder: ../../data/fixtures/candles/getPrices
        retry: 10

  - name: GET candles prices by date
    steps:
      - type: http
        method: POST
        url: "{{.url}}/candles/minute-close-prices"
        headers:
          Content-Type: application/json
        body: |
          {
            "SOLUSDC": [
              "2025-09-01T11:07:30Z",
              "2025-09-01T11:07:00Z",
              "2025-09-01T11:08:00Z"
            ]
          }
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson ShouldHaveLength 1
          - result.bodyjson.prices ShouldHaveLength 1
          - result.bodyjson.prices.SOLUSDC ShouldHaveLength 3
          - |
            result.bodyjson.prices.SOLUSDC ShouldEqual map[2025-09-01T11:07:00Z:199.67 2025-09-01T11:07:30Z:199.67 2025-09-01T11:08:00Z:199.38]
