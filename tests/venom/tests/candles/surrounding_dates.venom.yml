name: Candles service
version: '2'

testcases:
  - name: Reset db 
    steps:
      - type: dbfixtures
        database: postgres
        dsn: "{{ .pgsql_dsn }}"
        migrations: ../../data/schemas/
        folder: ../../data/fixtures/candles/surroundingDates
        retry: 10
  - name: Get surrounding dates
    steps:
      - name: Should return correct dates
        type: http
        method: GET
        url: "{{.url}}/candles/surrounding-dates?pair=BTCUSDT&interval=1h"
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.first_date ShouldEqual 2024-02-08T09:00:00+09:00
          - result.bodyjson.last_date ShouldEqual 2024-02-10T08:00:00+09:00
      - name: Should return 404 as not candles found
        type: http
        method: GET
        url: "{{.url}}/candles/surrounding-dates?pair=NOTHING&interval=1h"
        assertions:
          - result.statuscode ShouldEqual 404
          - result.bodyjson.error ShouldHaveLength 2
          - result.bodyjson.error.app_code ShouldEqual 2
          - result.bodyjson.error.message ShouldEqual no candles found for this pair and interval
